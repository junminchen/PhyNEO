<ForceField>
    <AtomTypes>
        <Type name="1" class="OS" element="O" mass="15.999"/>
        <Type name="2" class="CT" element="C" mass="12.0107"/>
        <Type name="3" class="OS" element="O" mass="15.999"/>
        <Type name="4" class="CT" element="C" mass="12.0107"/>
        <Type name="5" class="HC" element="H" mass="1.00784"/>
    </AtomTypes>
    <Residues>
        <Residue name="ECA">
            <Atom name="O00" type="1"/>
            <Atom name="C01" type="2"/>
            <Atom name="O02" type="3"/>
            <Atom name="C03" type="4"/>
            <Atom name="C04" type="4"/>
            <Atom name="O05" type="3"/>
            <Atom name="H06" type="5"/>
            <Atom name="H07" type="5"/>
            <Atom name="H08" type="5"/>
            <Atom name="H09" type="5"/>
            <Bond from="0" to="1"/>
            <Bond from="1" to="2"/>
            <Bond from="1" to="5"/>
            <Bond from="2" to="3"/>
            <Bond from="5" to="4"/>
            <Bond from="3" to="4"/>
            <Bond from="3" to="6"/>
            <Bond from="3" to="7"/>
            <Bond from="4" to="8"/>
            <Bond from="4" to="9"/>
        </Residue>
    </Residues>

    <!-- 1. Repulsion + Damped Electrostatics (短程力，无长程修正) -->
    <!-- Python脚本会自动将其识别为 Repulsion，并禁用 LRC -->
    <CustomNonbondedForce bondCutoff="4"
        energy="A*K2*exp(-B*r) + (-138.93542)*exp(-B*r)*(1+B*r)*Q/r;
        K2=(Br^2)/3 + Br + 1;
        Br = B*r;
        B=sqrt(Bexp1*Bexp2);
        Q=Q1*Q2;
        A=Aex-Ael-Ain-Adh-Adi;
        Aex=(Aexch1*Aexch2);
        Ael=(Aelec1*Aelec2);
        Ain=(Aind1*Aind2);
        Adh=(Adhf1*Adhf2);
        Adi=(Adisp1*Adisp2)">

        <PerParticleParameter name="Aexch"/>
        <PerParticleParameter name="Aelec"/>
        <PerParticleParameter name="Aind"/>
        <PerParticleParameter name="Adhf"/>
        <PerParticleParameter name="Adisp"/>
        <PerParticleParameter name="Bexp"/>
        <PerParticleParameter name="Q"/>

        <Atom type="1" Aexch="1" Aelec="2" Aind="3" Adisp="4" Adhf="5" Bexp="3.781251e+01" Q="-6.162220e-01"/>
        <Atom type="2" Aexch="1" Aelec="2" Aind="3" Adisp="4" Adhf="5" Bexp="3.437579e+01" Q="9.298613e-01"/>
        <Atom type="3" Aexch="1" Aelec="2" Aind="3" Adisp="4" Adhf="5" Bexp="3.781251e+01" Q="-3.762758e-01"/>
        <Atom type="4" Aexch="1" Aelec="2" Aind="3" Adisp="4" Adhf="5" Bexp="3.437579e+01" Q="1.004548e-01"/>
        <Atom type="5" Aexch="1" Aelec="2" Aind="3" Adisp="4" Adhf="5" Bexp="3.778372e+01" Q="5.954488e-02"/>
    </CustomNonbondedForce>

    <!-- 2a. Dispersion Main (无阻尼，负责长程 LRC) -->
    <!-- 这个力场只有 C6/r^6，OpenMM 可以对它进行积分，不会报错 -->
    <CustomNonbondedForce bondCutoff="4"
        energy=" - C6/(r^6) - C8/(r^8) - C10/(r^10);    
        C6=sqrt(C61*C62);
        C8=sqrt(C81*C82);
        C10=sqrt(C101*C102)">
        <PerParticleParameter name="C6"/>
        <PerParticleParameter name="C8"/>
        <PerParticleParameter name="C10"/>
        <Atom type="1" C6="1.158425e-03" C8="7.175195e-05" C10="2.082804e-06"/>
        <Atom type="2" C6="8.422619e-04" C8="4.418617e-05" C10="1.240508e-06"/>
        <Atom type="3" C6="8.381411e-04" C8="4.308587e-05" C10="1.073917e-06"/>
        <Atom type="4" C6="1.263260e-03" C8="8.710687e-05" C10="2.910050e-06"/>
        <Atom type="5" C6="9.962492e-05" C8="3.288732e-06" C10="5.645362e-08"/>
    </CustomNonbondedForce>

    <!-- 2b. Dispersion Damping Correction (短程修正) -->
    <!-- 正号！这是把上面多算的吸引力补回来。只在短程有效，不需要 LRC -->
    <CustomNonbondedForce bondCutoff="4"
        energy="(exp(-x)*(1+x+0.5*x^2+x^3/6+x^4/24+x^5/120+x^6/720)) * C6/(r^6)
        + (exp(-x)*(1+x+0.5*x^2+x^3/6+x^4/24+x^5/120+x^6/720+x^7/5040+x^8/40320)) * C8/(r^8)
        + (exp(-x)*(1+x+0.5*x^2+x^3/6+x^4/24+x^5/120+x^6/720+x^7/5040+x^8/40320+x^9/362880+x^10/3628800)) * C10/(r^10);
        x=B*r - (2*B^2*r+3*B)/(B^2*r^2+3*B*r+3)*r;
        B=sqrt(Bexp1*Bexp2);
        C6=sqrt(C61*C62);
        C8=sqrt(C81*C82);
        C10=sqrt(C101*C102)">

        <PerParticleParameter name="Bexp"/>
        <PerParticleParameter name="C6"/>
        <PerParticleParameter name="C8"/>
        <PerParticleParameter name="C10"/>
        <Atom type="1" Bexp="3.781251e+01" C6="1.158425e-03" C8="7.175195e-05" C10="2.082804e-06"/>
        <Atom type="2" Bexp="3.437579e+01" C6="8.422619e-04" C8="4.418617e-05" C10="1.240508e-06"/>
        <Atom type="3" Bexp="3.781251e+01" C6="8.381411e-04" C8="4.308587e-05" C10="1.073917e-06"/>
        <Atom type="4" Bexp="3.437579e+01" C6="1.263260e-03" C8="8.710687e-05" C10="2.910050e-06"/>
        <Atom type="5" Bexp="3.778372e+01" C6="9.962492e-05" C8="3.288732e-06" C10="5.645362e-08"/>
    </CustomNonbondedForce>
</ForceField>